<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: data/searchprovider/gnoSearchProvider.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: data/searchprovider/gnoSearchProvider.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
    Copyright (C) 2014-2015, THE PANACEA PROJECTS &lt;panacier@gmail.com>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software Foundation,
    Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
*/

const GLib = imports.gi.GLib;
const Gio = imports.gi.Gio;
const Lang = imports.lang;
const St = imports.gi.St;

const Layout = imports.ui.layout;
const Main = imports.ui.main;

const Me = imports.misc.extensionUtils.getCurrentExtension();
const Log = Me.imports.scripts.misc.log;
const AbstractSearchProvider = Me.imports.scripts.data.searchprovider.abstractSearchProvider.AbstractSearchProvider;
const SearchLaunchable = Me.imports.scripts.data.launchable.SearchLaunchable;

/**
 * @description Dialog title.
 * @private
 */
const GNO_NAME = 'Gno the Gnominator';
/**
 * @description Command that is executed when the dialog is run.
 * @private
 */
const GNO_COMMAND = 'fortune';
/**
 * @description Terms that show the fortune button.
 */
const MAGIC_GNO_KEY = 'free the gno';


/**
 * @class FortuneDialog
 *
 * @classdesc Copy of the wanda fortune dialog of the Gnome Shell.
 *
 * @description .
 * 
 *
 * @author AxP &lt;Der_AxP@t-online.de>
 * @author passingthru67 &lt;panacier@gmail.com>
 * @version 1.0
 */
const FortuneDialog = new Lang.Class({
    
    Name: 'GnoMenu.FortuneDialog',

    
    _init: function(name, command) {
        let text;
        try {
            let [res, stdout, stderr, status] = GLib.spawn_command_line_sync(command);
            text = String.fromCharCode.apply(null, stdout);
        } catch(e) {
            text = _("Sorry, no wisdom for you today:\n%s").format(e.message);
        }

        this._title = new St.Label({ style_class: 'prompt-dialog-headline', text: _("%s the Oracle says").format(name) });
        this._label = new St.Label({ style_class: 'prompt-dialog-description', text: text });
        this._label.clutter_text.line_wrap = true;

        this._box = new St.BoxLayout({ vertical: true, style_class: 'prompt-dialog'}); // this is just to force a reasonable width
        this._box.add(this._title, { align: St.Align.MIDDLE });
        this._box.add(this._label, { expand: true });

        this._button = new St.Button({ button_mask: St.ButtonMask.ONE, style_class: 'modal-dialog', reactive: true });
        this._button.connect('clicked', Lang.bind(this, this.destroy));
        this._button.child = this._box;

        this._bin = new St.Bin({ x_align: St.Align.MIDDLE, y_align: St.Align.MIDDLE });
        this._bin.add_constraint(new Layout.MonitorConstraint({ primary: true }));
        this._bin.add_actor(this._button);

        Main.layoutManager.addChrome(this._bin);

        GLib.timeout_add_seconds(GLib.PRIORITY_DEFAULT, 10, Lang.bind(this, this.destroy));
    },

    /**
     * @description Destroys the dialog.
     * @function
     * @memberOf FortuneDialog#
     */
    destroy: function() {
        this._bin.destroy();
    }
});



/**
 * @class GnoSearchProvider
 * @extends AbstractSearchProvider
 *
 * @classdesc Copy of the wanda fortune search provider.
 *
 * @description .
 * 
 *
 * @author AxP &lt;Der_AxP@t-online.de>
 * @author passingthru67 &lt;panacier@gmail.com>
 * @version 1.0
 */
const GnoSearchProvider = new Lang.Class({
    
    Name: 'GnoMenu.GnoSearchProvider',
    Extends: AbstractSearchProvider,

    
    _init: function() {
        this.id = 'provider_gno';
        
        this.reset();
    },
    
    /**
     * @description Resets the provider.
     * @function
     * @memberOf GnoSearchProvider#
     */
    reset: function() {
        this._results = null;
    },
    
    /**
     * @description Returns a list of results optinally filtered.
     * @param {Object} filterParams
     * @returns {List}
     * @function
     * @memberOf GnoSearchProvider#
     */
    getResults: function(filterParams) {
        return this._results;
    },

    /**
     * @description Returns the refined searchresults created from the raw results.
     * @param {List} apps
     * @returns {SearchLaunchableList}
     * @function
     * @memberOf GnoSearchProvider#
     */
    getResultMetas: function(gno) {
        if (gno &amp;&amp; gno.length > 0) {
            let name = gno[0];
            let description = "";
            let getIconFunc = function() {
                // I thought a monkey would be somewhat funny.
                return Gio.icon_new_for_string('face-monkey-symbolic');
            }
            // Creates on launch the dialog.
            let launchFunc = Lang.bind(this, function(openNew, params) {
                if (this._dialog)
                    this._dialog.destroy();
                let str = gno[0].toUpperCase() + gno[0].substring(1, gno.length)
                this._dialog = new FortuneDialog(str, GNO_COMMAND);
            });
            
            let res = new SearchLaunchable(name, description, getIconFunc, launchFunc);
            return [res];
        }
        return [];
    },

    /**
     * @description Receives the startset of results for a search run. Calls
     *              the updateCallback afterwards.
     * @function
     * @memberOf GnoSearchProvider#
     */
    getInitialResultSet: function(terms) {
        if (terms &amp;&amp; terms.join(' ') == MAGIC_GNO_KEY) {
            this._results = [ GNO_NAME ];
        } else {
            this._results = [];
        }
        
        if (this._updateCallback) {
            this._updateCallback();
        }
    },

    /**
     * @description Refines the current search run. Calls the updateCallback
     *              afterwards.
     * @function
     * @memberOf GnoSearchProvider#
     */
    getSubsearchResultSet: function(terms) {
        this.getInitialResultSet(terms);
        
        if (this._updateCallback) {
            this._updateCallback();
        }
    },
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AbstractSearchProvider.html">AbstractSearchProvider</a></li><li><a href="ActivitiesButton.html">ActivitiesButton</a></li><li><a href="AppSearchProvider.html">AppSearchProvider</a></li><li><a href="AppsManager.html">AppsManager</a></li><li><a href="Button.html">Button</a></li><li><a href="ButtonGroup.html">ButtonGroup</a></li><li><a href="CategoryBox.html">CategoryBox</a></li><li><a href="CategoryPane.html">CategoryPane</a></li><li><a href="Component.html">Component</a></li><li><a href="ControlPane.html">ControlPane</a></li><li><a href="Datamanager.html">Datamanager</a></li><li><a href="DescriptionBox.html">DescriptionBox</a></li><li><a href="DraggableButton.html">DraggableButton</a></li><li><a href="DraggableGridButton.html">DraggableGridButton</a></li><li><a href="DraggableIconButton.html">DraggableIconButton</a></li><li><a href="DraggableListButton.html">DraggableListButton</a></li><li><a href="FortuneDialog.html">FortuneDialog</a></li><li><a href="GnoSearchProvider.html">GnoSearchProvider</a></li><li><a href="IconButton.html">IconButton</a></li><li><a href="IconToggleButton.html">IconToggleButton</a></li><li><a href="InternalButton.html">InternalButton</a></li><li><a href="Launchable.html">Launchable</a></li><li><a href="MainArea.html">MainArea</a></li><li><a href="Menu.html">Menu</a></li><li><a href="MenuButton.html">MenuButton</a></li><li><a href="MenuMediator.html">MenuMediator</a></li><li><a href="MenuModel.html">MenuModel</a></li><li><a href="MenuSearch.html">MenuSearch</a></li><li><a href="MenuSettings.html">MenuSettings</a></li><li><a href="ModelObserver.html">ModelObserver</a></li><li><a href="NavigationArea.html">NavigationArea</a></li><li><a href="NavigationBox.html">NavigationBox</a></li><li><a href="PanelBox.html">PanelBox</a></li><li><a href="PanelButton.html">PanelButton</a></li><li><a href="PlacesManager.html">PlacesManager</a></li><li><a href="PreferencesButton.html">PreferencesButton</a></li><li><a href="ProviderResultBoxBase.html">ProviderResultBoxBase</a></li><li><a href="ProviderResultBoxButton.html">ProviderResultBoxButton</a></li><li><a href="ProviderResultGrid.html">ProviderResultGrid</a></li><li><a href="ProviderResultList.html">ProviderResultList</a></li><li><a href="RecentFilesManager.html">RecentFilesManager</a></li><li><a href="ResultArea.html">ResultArea</a></li><li><a href="SearchField.html">SearchField</a></li><li><a href="SearchLaunchable.html">SearchLaunchable</a></li><li><a href="SearchSystem.html">SearchSystem</a></li><li><a href="ShortcutArea.html">ShortcutArea</a></li><li><a href="ShortcutBoxBase.html">ShortcutBoxBase</a></li><li><a href="ShortcutGrid.html">ShortcutGrid</a></li><li><a href="ShortcutList.html">ShortcutList</a></li><li><a href="Sidebar.html">Sidebar</a></li><li><a href="StyleManager.html">StyleManager</a></li><li><a href="TextButton.html">TextButton</a></li><li><a href="TextToggleButton.html">TextToggleButton</a></li><li><a href="ToggleButton.html">ToggleButton</a></li><li><a href="UpdateableComponent.html">UpdateableComponent</a></li><li><a href="ViewModePane.html">ViewModePane</a></li><li><a href="WorkspaceBox.html">WorkspaceBox</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ECategoryDescriptionID">ECategoryDescriptionID</a></li><li><a href="global.html#ECategoryID">ECategoryID</a></li><li><a href="global.html#ECategoryNum">ECategoryNum</a></li><li><a href="global.html#EEventType">EEventType</a></li><li><a href="global.html#EMenuLayout">EMenuLayout</a></li><li><a href="global.html#EMousebutton">EMousebutton</a></li><li><a href="global.html#ESelectionMethod">ESelectionMethod</a></li><li><a href="global.html#EViewMode">EViewMode</a></li><li><a href="global.html#MAGIC_GNO_KEY">MAGIC_GNO_KEY</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-dev</a> on Thu Dec 04 2014 18:05:17 GMT+0100 (MEZ)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
